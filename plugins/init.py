from core import VK
import sys
from plugins.db import cursor as db, con


class main:
    triggers = [['init', 'Создает таблицы и всякую такую суету. В работе не используется']]

    def execute(self, vk : VK, peer : int, **mess):
        if "-init" in sys.argv:
            db.execute("CREATE TABLE IF NOT EXISTS moders   (vk_id INT NOT NULL PRIMARY KEY, event INT DEFAULT 0, days_without_posts INT DEFAULT 0, money_left INT DEFAULT 0, rebs INT DEFAULT 0, UNIQUE(vk_id))")
            db.execute("CREATE TABLE IF NOT EXISTS vacation (vk_id INT NOT NULL PRIMARY KEY, date_of_start TEXT NOT NULL, date_of_end TEXT NOT NULL, UNIQUE(vk_id))")
            db.execute("CREATE TABLE IF NOT EXISTS admins   (vk_id INT NOT NULL, UNIQUE(vk_id))")
            db.execute("CREATE TABLE IF NOT EXISTS counter  (vk_id INT NOT NULL, posts INT DEFAULT 0, UNIQUE(vk_id))")
            db.execute("CREATE TABLE IF NOT EXISTS reports  (id INTEGER PRIMARY KEY AUTOINCREMENT, vk_id INT NOT NULL, prize INT DEFAULT 0, winner TEXT NOT NULL, date_of_report TEXT NOT NULL, photo_url TEXT NOT NULL, UNIQUE(id))")
            db.execute("CREATE TABLE IF NOT EXISTS rebs     (id INTEGER PRIMARY KEY AUTOINCREMENT, vk_id INT NOT NULL, action INT DEFAULT 1, admin INT NOT NULL, date_of_reb TEXT NOT NULL, comment TEXT, UNIQUE(id))")
            con.commit()
            vk.api("messages.send", peer_id=peer, reply_to=mess['id'], message="+")

        